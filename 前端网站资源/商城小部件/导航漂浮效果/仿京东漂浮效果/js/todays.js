/* product-home/1.0.0 todays.js Date:2015-05-22 10:00:03 */
define("product/home/1.0.0/widget/todays/todays.js",["jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js","jdf/1.0.0/ui/switchable/1.0.0/switchable.js","jdf/1.0.0/ui/lazyload/1.0.0/lazyload.js"],function(require,a){require("jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js"),require("jdf/1.0.0/ui/switchable/1.0.0/switchable.js"),require("jdf/1.0.0/ui/lazyload/1.0.0/lazyload.js");var c=$("#todays");var d="http://diviner.jd.com/diviner?p=610010&uuid=994493768&sku=&skus=&ck=_pst,aview&c1=&c2=&c3=&lid=1&lim=8&sp=&hi=&fe=&fne=&ro=&ec=gbk";var e="http://mercury.jd.com/log.gif?t=rec.610010&v=src=rec$errorcode=";var f=null;var g=0;var h=[[1,1,2,2],[1,1,3,3],[1,1,3,3],[1,1,3,3]];var i=[];var j='<div class="jd-clock-wrap"><div class="jd-clock"><div class="jd-clock-h" id="jdClockHours"></div><div class="jd-clock-m"></div><div class="jd-clock-s"></div></div></div>';var k=document.documentElement.style;var l=void 0!=k.webkitTransform||void 0!=k.MozTransform;var m=[];var n='<a href="${t}" target="_blank"><img data-lazy-img="${imgRoot}${img}" width="250" height="164"/> </a>';var o='<a href="${t}" target="_blank" fclog="${clog}"><img data-lazy-img="${imgRoot}${img}" width="250" height="164"/> </a>';c.html('<div class="mt" clstag="h|keycount|2015|11a">'+(l?j:"<h2>\u4eca\u65e5\u63a8\u8350</h2>")+'</div><div class="mc slider clearfix"><ul class="slider-main"></ul><div class="slider-page" style="display: none;"><a href="javascript:void(0)" class="slider-prev" clstag="h|keycount|2015|11b1">&lt;</a><a href="javascript:void(0)" class="slider-next" clstag="h|keycount|2015|11b2">&gt;</a></div></div>');var p=4;var q=0;var r="";$.each(h,function(a,b){var c=[];$.each(b,function(b,d){q++,r=0==a&&2>b?'<div style="width: 100%;height: 152px;background: #eee;text-align: center;"><img style="margin-top: 60px;" src="http://misc.360buyimg.com/product/home/1.0.0/css/i/loading.gif" width="32" height="32"/> </div>':'<a><img width="250" height="164"/> </a>',c.push('<div class="fore'+(b+1)+'" data-source="'+d+'" data-fill="0" clstag="h|keycount|2015|11c'+(9>=q?"0"+q:q)+'">'+r+"</div>")}),m.push('<li class="slider-panel fore'+(a+1)+'">'+c.join("")+"</li>")}),$(".slider-main",c).html(m.join(""));var s=$(".slider",c).switchable({type:"slider",hasPage:!0,contentClass:"slider-main",navItem:"slider-item",mainClass:"slider-panel",prevClass:"slider-prev",nextClass:"slider-next",speed:600,step:1,visible:1,seamlessLoop:!0,includeMargin:!0,onNext:function(){g++,g>3&&(g=0),x(2)},onPrev:function(){g--,0>g&&(g=3),x(4)},callback:function(a,b,c){p>1?p--:c.lazyload({space:0})}});$(".slider",c).hover(function(){$(".slider-page",c).show()},function(){$(".slider-page",c).hide()}),window.tempTodayRecCallback=function(a){if(clearTimeout(t),a&&a.success&&a.data){if(w(a.data),f=a.impr){u(a.impr);var b=a.impr.indexOf("$csku=");b>-1&&(f=a.impr.substring(0,b+6)+"{j_csku}",f+=a.impr.substring(a.impr.indexOf("$",b+6))),setTimeout(function(){$("#todays").lazyload({type:"fn",source:$("#todays .slider-main"),space:-50,onchange:function(){x(2)}})},0)}a.data.length<8&&w()}else w();v(a),window.tempTodayRecCallback=void 0};var t=setTimeout(function(){window.tempTodayRecCallback=function(){},w(),v(null,"timeout"),setTimeout(function(){window.tempTodayRecCallback=void 0},1e4)},1e3);$.ajax({url:d,dataType:"jsonp",jsonpCallback:"tempTodayRecCallback"}),$(".slider-main",c).delegate(".slider-panel div[data-clk]","click",function(){var a=$(this);u(a.data("clk"))});function u(a){if(a){var b=new Image;b.src=a+"&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer)+"&random="+Math.random(),b=null}}function v(a,b){var c=e;a?a.success?a.data&&a.data.length||u(c+"2"):u(c+"1"):u("timeout"==b?c+"3":c+"4")}function w(a){a?s.update(function(b){var c=b.find("div[data-source=1][data-fill=0]");$.each(a,function(a,b){var d=c.eq(a);d.html(2>a?n.process($.extend({imgRoot:pageConfig.FN_GetImageDomain(b.sku)},b)):n.process($.extend({imgRoot:pageConfig.FN_GetImageDomain(b.sku)},b))),d.attr("data-clk",b.clk),d.attr("data-sku",b.sku),d.removeAttr("data-fill")})}):y(1,i)}function x(a){if(f){var b=[];if($(".ui-switchable-panel-selected div[data-source=1][data-sku]",c).each(function(){var c=$(this).data("sku");$.trim(c)&&b.push(c)}),b.length>0){var d=f.replace("action=0","action="+a+"$index="+g).replace("{j_csku}",b.join(","));u(d)}}}function y(a,b){b&&b.length&&s.update(function(c){var d=c.find("div[data-source="+a+"][data-fill=0]");$.each(b,function(c,e){var f=d.eq(c);f.length>0&&(f.html((1==a||2==a)&&2>c?b[c].clog?o.process($.extend({imgRoot:""},e)):n.process($.extend({imgRoot:""},e)):b[c].clog?o.process($.extend({imgRoot:""},e)):n.process($.extend({imgRoot:""},e))),f.removeAttr("data-fill"))})})}function z(a){a&&a.length&&(i=a)}l&&!function(){var a=new Date;var b=a.getHours();var c=a.getMinutes();var d=b%12*30;var e=c/2;var f=d+e+"deg";$("#jdClockHours").css({webkitTransform:"rotate("+f+")",mozTransform:"rotate("+f+")"})}(),a.setDefaultRecData=z,a.updateAd=y});
