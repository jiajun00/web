/* product-toolbar/1.0.1 main.js Date:2015-07-30 14:44:04 */
define("http://misc.360buyimg.com/product/toolbar/1.0.1/js/main.js",["http://misc.360buyimg.com/jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js","http://misc.360buyimg.com/jdf/1.0.0/unit/login/1.0.0/login.js","http://misc.360buyimg.com/product/toolbar/1.0.1/widget/common/common.css"],function(require,a,b){require("http://misc.360buyimg.com/jdf/1.0.0/unit/trimPath/1.0.0/trimPath.js");var d=require("http://misc.360buyimg.com/jdf/1.0.0/unit/login/1.0.0/login.js");require("http://misc.360buyimg.com/product/toolbar/1.0.1/widget/common/common.css");var f="product/toolbar/1.0.1";/dev/.test(location.href)&&(f="");var g={$el:$("#J-global-toolbar"),pType:"",enabled:!0,bars:{cart:{enabled:!0,title:"\u8d2d\u7269\u8f66",href:"http://cart.jd.com/cart/cart.html?r="+Math.random(),js:f+"/widget/cart/cart.js",css:f+"/widget/cart/cart.css"},follow:{enabled:!0,title:"\u6211\u7684\u5173\u6ce8",login:!0,href:"http://t.jd.com/home/follow",js:f+"/widget/follow/follow.js",css:f+"/widget/follow/follow.css"},history:{enabled:!0,title:"\u6211\u7684\u8db3\u8ff9",href:"http://my.jd.com/history/list.html",js:f+"/widget/history/history.js",css:f+"/widget/history/history.css"},jimi:{enabled:!0,title:"\u54a8\u8be2JIMI",login:!0,iframe:"http://jimi.jd.com/index.action?source=jdhome"}},links:{top:{title:"\u9876\u90e8",anchor:"#shortcut-2013"},feedback:{title:"\u53cd\u9988",href:"http://diaoyan.jd.com/survey/answerSurvey.htm?eSurveyId=AZDFYX5KJGMOK"}},ad:null,onOpen:function(){},onClose:function(){},onRender:function(){}};var h=function(a){return"mousewheel"===a.type?a.wheelDelta>0?"up":"down":"DOMMouseScroll"===a.type?a.detail>0?"down":"up":"unknown"};var i=function(a){return 0===a.scrollTop()?"top":a.scrollTop()+a.outerHeight()>=a[0].scrollHeight?"bottom":"middle"};var j=function(a){return a[0].scrollHeight>a.innerHeight()};function k(a){this.settings=$.extend(!0,{},g,a),this.settings.links.top.href&&delete this.settings.links.top.anchor,this.settings.links.feedback.anchor&&delete this.settings.links.feedback.href,this.init()}k.prototype={init:function(){if(!this.settings.enabled)return!1;this.$w=$(window),this.$d=$(document),this.isIE6=$.browser.isIE6(),this.settings.clsPageType=this.getPageType();try{if(this.settings.ad&&this.settings.ad.startTime&&this.settings.ad.id){this.settings.ad.endTime||(this.settings.ad.endTime=this.settings.ad.startTime+7776e3);var a;var b;var c=(new Date).valueOf()/1e3;window.pageConfig&&window.pageConfig.timestamp?(b=window.pageConfig.timestamp/1e3,a=300>c-b&&c-b>0?c:b):a=c;var d;(d=window.location.search.match(/isdebugToolbarTime=(\d+)/))&&(a=parseInt(d[1],10)),a>this.settings.ad.startTime&&a<this.settings.ad.endTime?(this.settings.ad.show=!0,this.loadAD()):this.settings.ad.show=!1}else this.settings.ad=null}catch(e){this.settings.ad=null}this.render(),this.bindEvent(),this.opened=!1,this.triggerClick="z-jdm-tbar-tab-selected",this.triggerHover="z-jdm-tbar-tab-hover",this.toolbarOpen="z-jdm-toolbar-open",this.$toolbar=this.settings.$el.find(".J-toolbar"),this.$wrap=this.settings.$el.find(".J-wrap"),this.$trigger=this.settings.$el.find('.J-trigger[data-type="bar"]'),this.$content=this.settings.$el.find(".J-content"),this.$newItemInCartHint=this.settings.$el.find(".jdm-tbar-tab-cart .tabs-tip"),this.setBubbleCount("cart",readCookie("cn")),this.isIE6&&(this.resetLayout("height"),this.resetLayout("top"),this.resetLayout("right")),this.settings.$el.find("#J-toolbar-load-hook").trigger("click"),this.eventDispatcher=$({})},getPageType:function(){var a="h";switch(this.settings.pType){case"home":a="h";break;case"list":a="thirdtype";break;case"search":a="thirdtype";break;case"item":a="shangpin";break;default:a="h"}return a},render:function(){var a='                <div class="jdm-toolbar-wrap J-wrap">                    <div class="jdm-toolbar J-toolbar">                        <div class="jdm-toolbar-panels J-panel">                        {if ad && ad.show}                        <div data-name="ad" class="J-content jdm-toolbar-panel jdm-tbar-panel-ad">                            <h3 class="jdm-tbar-panel-header J-panel-header">                                <a>                                <i></i>                                <em class="title"></em>                                </a>                                <span class="close-panel J-close"></span>                            </h3>                            <div class="jdm-tbar-panel-main">                                <div class="jdm-tbar-panel-content J-panel-content">                                </div>                            </div>                        </div>                        {/if}                        {for bar in bars}                        {if bar.enabled}                            <div data-name="${bar_index}" class="J-content jdm-toolbar-panel jdm-tbar-panel-${bar_index}">                                <h3 class="jdm-tbar-panel-header J-panel-header">                                    <{if bar.href}a href="${bar.href}" target="_blank"{else}span{/if} class="title" clstag="${clsPageType}|keycount|cebianlan_${clsPageType}_${bar_index}|title">                                    <i></i>                                    <em class="title">${bar.title}</em>                                    </{if bar.href}a{else}span{/if}>                                    <span class="close-panel J-close"></span>                                </h3>                                <div class="jdm-tbar-panel-main">                                    <div class="jdm-tbar-panel-content J-panel-content">                                    <div class="jdm-tbar-tipbox2">                                        <div class="tip-inner">                                            <i class="i-loading"></i>                                        </div>                                    </div>                                    </div>                                </div>                                <div class="jdm-tbar-panel-footer J-panel-footer"></div>                            </div>                        {/if}                        {/for}                        </div>                        <div class="jdm-toolbar-header">                        {if ad && ad.show}                            <div class="jdm-tbar-act J-trigger" data-type="bar" data-name="ad" data-iframe="true"                                 clstag="${clsPageType}|keycount|cebianlan_${clsPageType}_header|"                             ></div>                            {/if}                        </div>                        <div class="jdm-toolbar-tabs J-tab">                        {for bar in bars}                        {if bar.enabled}                            <div data-type="bar"                                 clstag="${clsPageType}|keycount|cebianlan_${clsPageType}_${bar_index}|btn"                                 class="J-trigger jdm-toolbar-tab jdm-tbar-tab-${bar_index}"                                 data-name="${bar_index}"                                {if bar.login}data-login="${bar.login}"{/if}                                {if bar.iframe}data-iframe="${bar.iframe}"{/if}>                                                                <i class="tab-ico"></i>                                <em class="tab-text">${bar.title}</em>                                <span class="tab-sub J-count hide">0</span>                                <div class="tabs-tip hide">                                    <span class="ico"></span>                                    <span class="text">\u6210\u529f\u52a0\u5165\u8d2d\u7269\u8f66!</span>                                    <b></b>                                </div>                            </div>                        {/if}                        {/for}                        </div>                        <div class="jdm-toolbar-footer">                        {for link in links}                            <div data-type="link" class="J-trigger jdm-toolbar-tab jdm-tbar-tab-${link_index}">                                {if link.anchor}                                    <a href="${link.anchor}" clstag="${clsPageType}|keycount|cebianlan_${clsPageType}|${link_index}">                                    <i class="tab-ico"></i>                                    <em class="tab-text">${link.title}</em>                                    </a>                                {/if}                                {if link.href}                                    <a href="${link.href}" target="_blank" clstag="${clsPageType}|keycount|cebianlan_${clsPageType}|${link_index}">                                        <i class="tab-ico"></i>                                        <em class="tab-text">${link.title}</em>                                    </a>                                {/if}                            </div>                        {/for}                        </div>                        <div class="jdm-toolbar-mini">                        </div>                    </div>                    <div id="J-toolbar-load-hook" clstag="${clsPageType}|keycount|cebianlan_${clsPageType}|load"></div>                </div>';try{this.settings.$el.html(a.process(this.settings)),this.settings.onRender()}catch(b){console.log("Toolbar rendered error >> "+b)}},setBubbleCount:function(a,b){var c=this.$trigger.filter('[data-name="'+a+'"]').find(".J-count");var d;b>0?(d=b>99?"99+":b,c.html(d).show()):c.hide()},updateLayout:function(){var a=$(window).height();var b=this.$content.eq(this.m.index);var c=b.find(".J-panel-header").outerHeight();var d=b.find(".J-panel-footer").outerHeight();var e=b.find(".J-panel-content");e.css("height",a-c-d)},bindEvent:function(){var a=this;$(window).unbind("resize.toolbar").bind("resize.toolbar",function(){a.opened&&a.updateLayout()}),$(document).undelegate("click.toolbar").delegate("body","click.toolbar",function(b){$.contains(a.$wrap[0],b.target)||a.close()}),this.settings.$el.delegate(".J-trigger","mouseenter",function(){a.handleHover(!0,$(this))}),this.settings.$el.delegate(".J-trigger","mouseleave",function(){a.handleHover(!1,$(this))}),this.settings.$el.delegate(".J-trigger","click",function(){a.handleTrigger($(this))}),this.settings.$el.delegate(".J-close","click",function(){a.close()}),this.settings.$el.delegate(".J-panel-content","mousewheel DOMMouseScroll",function(a){var b=$(this);var c=h(a);var d=i(b);var e=j(b);(!e||f()||g())&&a.preventDefault();function f(){return"up"===c&&"top"===d}function g(){return"down"===c&&"bottom"===d}}),this.isIE6&&(this.$w.bind("resize",function(){a.resetLayout("height"),a.resetLayout("right")}),this.$w.bind("scroll",function(){a.resetLayout("top")}))},resetLayout:function(a){if("height"===a){var b=this.$w.height();this.$toolbar.add(this.$wrap).css("height",b)}if("top"===a){var c=this.$d.scrollTop();this.$wrap.css("top",c)}"right"===a&&(this.$w.width()%2>0?this.$wrap.css("right",-1):this.$wrap.css("right",0))},handleHover:function(a,b){var c=this;b.parent().hasClass("jdm-toolbar-header")||(a?b.addClass(c.triggerHover):b.removeClass(c.triggerHover))},handleTrigger:function(a){var b=this;var c=this.$trigger.index(a);var e="bar"===a.attr("data-type");var f={index:c,login:a.attr("data-login"),name:a.attr("data-name"),iframe:a.attr("data-iframe")};return b.opened&&c===b.$content.data("last")?void b.close():(this.m=f,e?void(f.login?d({modal:!0,complete:function(){b.open(f)}}):this.open(f)):!1)},switchTo:function(a){this.eventDispatcher.trigger(a.name+"PanelOpen"),this.$trigger.removeClass(this.triggerClick),this.$trigger.eq(a.index).parent().hasClass("jdm-toolbar-header")||this.$trigger.eq(a.index).addClass(this.triggerClick);var b=this.$content.data("last");b!=a.index&&(this.$content.css("visibility","hidden"),this.$content.eq(a.index).css("z-index","2"),this.$content.eq(a.index).css("visibility","visible"),void 0!=b&&(this.$content.eq(b).css("z-index","1").css("visibility","visible"),this.$content.eq(b).removeClass("toolbar-animate-in").addClass("toolbar-animate-out")),this.$content.eq(a.index).removeClass("toolbar-animate-out").addClass("toolbar-animate-in"),this.$content.data("last",a.index),this.settings.bars[a.name].loaded||this.load(a),this.updateLayout(a))},load:function(a){var b=this;var c=this.$content.eq(a.index);var d=c.find(".J-panel-header");var e=c.find(".J-panel-content");var f=c.find(".J-panel-footer");if(a.iframe){var g='<iframe frameborder="0" style="height:100%;width:100%;" width="100%" height="100%" src="'+this.settings.bars[a.name].iframe+'"></iframe>';e.html(g),this.settings.bars[a.name].loaded=!0}else{var h=this.settings.bars[a.name].js;seajs.use(h,function(c){c&&new c({$header:d,$content:e,$footer:f}),b.settings.bars[a.name].loaded=!0})}},loadAD:function(){var a=this;var b="http://fa.360buy.com/loadFa.js?aid="+this.settings.ad.id;$.ajax({url:b,dataType:"script",scriptCharset:"gbk",success:function(){a.settings.bars.ad={name:"ad",iframe:a.$wrap.find(".jdm-tbar-panel-ad").attr("data-iframe")}}})},open:function(a){this.$wrap.addClass(this.toolbarOpen),this.opened=!0,this.switchTo(a)},close:function(){this.$wrap.removeClass(this.toolbarOpen),this.$trigger.removeClass(this.triggerClick).removeClass(this.triggerHover),this.opened=!1},setStatus:function(a,b,c){c=c||"fd";var d='            <div>                <div class="jdm-tbar-tipbox2">                    <div class="tip-inner">                        <i class="i-face-'+c+' tip-face"></i>                        <div class="tip-text">                            {content}                        </div>                    </div>                </div>            <div>';a.html(d.replace("{content}",b))},newItemInCart:function(){var a=this.$trigger.filter('[data-name="cart"]').find(".J-count");var b;b=a.is(":visible")?parseInt(a.text(),10):0,this.setBubbleCount("cart",b+1),this.$newItemInCartHint.stop().show().css({opacity:1}).delay(800).fadeOut(600)},sendLog:function(a,b,c){log("ce_bian_lan","0000110",this.settings.pType,a,b,c)}},b.exports=k});
