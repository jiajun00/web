/* product-home/1.0.0 guess-like.js Date:2015-03-17 15:29:22 */
seajs.use(["jdf/1.0.0/unit/trimPath/1.0.0/trimPath","jdf/1.0.0/ui/lazyload/1.0.0/lazyload"],function(){var a=$("#lazy-guess-like");a.html('<div id="guessyou" class="m"></div>');var b=(document.characterSet||document.charset||"gbk").toLowerCase();"gb2312"==b&&(b="gbk");var c=$("#guessyou");var d=null;var e=null;var f=["b","c","d","e"];var g=6;var h=0;var i={dataList:[],impr:null,pageNo:0,pageCount:0,len:0};var j="http://diviner.jd.com/diviner?p=610009&uuid=12396477&sku=&skus=&&c1=&c2=&c3=&lid=1&lim=24&sp=&hi=&fe=&fne=&ro=&ec="+b+"&ck=_pst,aview";var k="http://mercury.jd.com/log.gif?t=rec.610009&v=src=rec$errorcode=";var l='		<li class="fore${index}" clstag="${clstag}">			<div class="p-img"><a data-clk="${clk}" href="http://item.jd.com/${sku}.html" target="_blank">{if type == 0}<img data-lazy-img="${imgRoot}${img}" width=130 height=130 title="${t}">{else}<img src="${imgRoot}${img}" width=130 height=130 title="${t}">{/if}</a></div>				<div class="p-info">				<div class="p-name"><a data-clk="${clk}" href="http://item.jd.com/${sku}.html" target="_blank" title="${t}">${t}</a></div>				{if jp == null}<div class="p-price" data-lazy-price="${sku}">&nbsp;</div>{else}{if jp && jp > 0}<div class="p-price"><i>\xa5</i>${jp}</div>{else}<div class="p-price" style="font-size: 14px;">\u6682\u65e0\u62a5\u4ef7</div>{/if}{/if}			</div>		</li>';c.html('<div class="mt"><h2>\u731c\u4f60\u559c\u6b22</h2><a href="javascript:;" class="extra" clstag="h|keycount|2015|12a">\u6362\u4e00\u6279</a></div><div class="mc"><div class="spacer"><i></i></div><ul></ul></div>'),d=$(".mc ul",c),e=$(".extra",c);function m(b){var c=function(){if(i.len>=6){var a=h*g;var c=(h+1)*g;return c>=i.len&&(c=i.len),b(i.dataList.slice(a,c)),h++,h>=i.pageCount&&(h=0),!0}return!1};c()||(window.tempGuessLikeCallback=function(c){var d=-1;c&&c.success&&c.data&&c.data.length>0?($.each(c.data,function(a,b){b.jp=null}),i.dataList=c.data,i.len=i.dataList.length,i.pageCount=Math.ceil(i.dataList.length/g),i.impr=c.impr,d=c.impr.indexOf("$csku="),d>-1&&(i.impr=c.impr.substring(0,d+6)+"{j_csku}",i.impr+=c.impr.substring(c.impr.indexOf("$",d+6))),m(b),n(),r(c.impr),setTimeout(function(){$("#guessyou").lazyload({type:"fn",source:$("#guessyou li.fore1 .p-price"),onchange:function(){q()}})},0),$("#guessyou").lazyload({space:0})):a.hide(),s(c),window.tempGuessLikeCallback=void 0},$.ajax({url:j,dataType:"jsonp",jsonpCallback:"tempGuessLikeCallback",error:function(){a.hide(),s(null,"timeout"),window.tempGuessLikeCallback=function(){},setTimeout(function(){window.tempGuessLikeCallback=void 0},1e4)},timeout:1500}))}function n(){var a=[];$.each(i.dataList,function(b,c){a.push("J_"+c.sku)}),a.length>0&&$.getJSON("http://p.3.cn/prices/mgets?skuIds="+a.join(",")+"&callback=?",function(a){a&&($.each(i.dataList,function(b,c){$.each(a,function(a,b){return"J_"+c.sku==b.id?(c.jp=b.p,!1):void 0})}),$(".p-price[data-lazy-price]",c).each(function(){var a=$(this);var b=a.attr("data-lazy-price");$.each(i.dataList,function(c,d){return b==d.sku?(a.removeAttr("data-lazy-price"),d.jp&&d.jp>0?a.html("<i>\xa5</i>"+d.jp):a.css("font-size","14px").html("\u6682\u65e0\u62a5\u4ef7"),a.show(),!1):void 0})}))})}var o=[];function p(a){m(function(b){var c=[];o=[],$.each(b,function(b,d){o.push(d.sku),c.push(l.process($.extend({index:b+1,clstag:"h|keycount|2015|12"+f[h]+(b+1),imgRoot:pageConfig.FN_GetImageDomain(d.sku)+"n1/s130x130_",type:a},d)))}),d.html(c.join(""))})}function q(){var a=i.impr;a&&(a=a.replace("action=0","action=2$index="+i.pageNo).replace("{j_csku}",o.join(",")),r(a),i.pageNo+=1)}function r(a){if(a){var b=new Image;b.src=a+"&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer)+"&random="+Math.random(),b=null}}function s(a,b){var c=k;a?a.success?a.data&&a.data.length||r(c+"2"):r(c+"1"):r("timeout"==b?c+"3":c+"4")}e.bind("click",function(a){p(1),q(),a.preventDefault()}),c.delegate("a[data-clk]","click",function(){r($(this).data("clk"))}),p(0)});
